<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style.css" type="text/css">
    <link rel="stylesheet" href="../style_index.css" type="text/css">
    <meta property="og:image" content="https://e-coach-ai.com/articles/article2_imgs/thumb_article2.png">
    <meta property="og:description" content="モンテカルロ木探索やそれに必要な木構造など、オセロアルゴリズムについて解説第2回">
    <meta property="og:title" content="オセロのアルゴリズムに関して2">
    <meta property="og:image:width" content="960">
    <meta property="og:image:height" content="510">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://e-coach-ai.com/articles/article2.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@e_Coachi_AI">
    <script type="text/javascript" asyncsrc="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=MML_SVG"></script>
    <title>オセロのアルゴリズムに関して2</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9408963746965745"
     crossorigin="anonymous"></script>
    <link rel="apple-touch-icon" href="../imgs\favicon.ico">
    <link rel="icon" href="../imgs\favicon.ico">
</head>
<body>
    <div id="head_nav">
        <div id="header">
            <a href="../index.html"><img src="../imgs\sawayaka.png" alt="e-Coach_AIのロゴ画像" id="logo"></a>
        </div>
        <nav>
            <a href="../index.html">ホーム</a>
            <a href="../list.html">記事一覧</a>
            <a href="../play_othello.html">オセロゲーム</a>
        </nav>
    </div>
    
    <div  class="main_title">
        <h1>オセロのアルゴリズムに関して</h1>
    </div>
    <div class="main_content">
        <h2 id="theme">第2回：モンテカルロ木探索</h2>
        <p id="intro">この記事では、前回説明を省略した「モンテカルロ木探索」の詳細や、探索アルゴリズムにおける「木」の概念、「モンテカルロ法」の問題点などを絡めて解説します。
        </p>
        <img src="../articles/article2_imgs/thumb_article2.png" id="thumb_nail" alt="このページのサムネイル。「オセロのアルゴリズム解説　第一回　minimax法？モンテカルロ法？　そもそもアルゴリズムとは？　基本的な事項を解説！　と書いてある。">
        <p>前回の記事はこちらからどうぞ</p>
        <a href="../articles/article1.html" target="_blank" class="same_domain">
            <div>
                <img src="" alt="リンク先のページのサムネイル画像">
                <section><h5></h5><p></p></section>
            </div>
        </a>
        <div class="ads">
            <!-- admax -->
            <div class="admax-switch" data-admax-id="39fee66d53fcb638473cc0c0ffce024f" style="display:inline-block;"></div>
            <script type="text/javascript">
            (admaxads = window.admaxads || []).push({admax_id: "39fee66d53fcb638473cc0c0ffce024f",type: "switch"});</script>
            <script type="text/javascript" charset="utf-8" src="https://adm.shinobi.jp/st/t.js" async></script>
            <!-- admax -->
        </div>
        <h3 id="1">1.モンテカルロ法の問題点</h3>
        <p>
            基本的にモンテカルロ法では、着手可能手にそれぞれn回の試行を行う方式をとります。そのため、中盤の選択肢が膨らむ局面では試行回数が多くなり処理時間が長くなってしまうという問題があります。<br>
            その問題を解決する手法がモンテカルロ木探索です。この手法の特徴を一言で説明すると、<b>「勝てそうな手を優先して試行する」</b>というものです。もう少し具体的な流れを説明すると、
        </p>
        <ul>
            <li>最初は全ての手を平等に試す</li>
            <li>試行を重ねていくうちに、勝率が高そうな手が見えてきたら、そちらを多めに試す</li>
            <li>ただし、初期の勝率はまだ不確かなので、他の手も試す（探索の幅を残す）</li>
        </ul>
        <p>
            です。<br>
            このようにして、“手の評価”と“試行回数の配分”を同時に最適化していくのがモンテカルロ木探索の基本的な考え方です。この手法では一定量の試行回数を効率的に割り振ることができるため、はやい速度を保つことが可能です。
        </p>
        <h3 id="2">2.木構造とは</h3>
        <p>
            モンテカルロ<b>「木」</b>探索という名前にもある通り、この手法では「木構造（ツリー構造）」という形を使って、探索の過程を整理・管理しています。<br>
            そもそも木構造とは、1つの親ノードから複数の子ノードが枝分かれする構造のことを指します。これは、ゲームの先読み（探索）と非常に相性が良いのです。<br>
            例えばオセロで、ある1手目の後に取りうる選択肢が複数あり、さらにその後の2手目の選択肢も複数存在して、3手目...というように、1手ごとに分岐が広がっている構造を想像してみてください。このとき、<br>
            <b>それぞれの盤面を「ノード」として表し、</b><br>
            <b>そこから可能な次の手を枝分かれさせていく</b><br>
            という形で整理するのが「木構造」です。<br>
            この図のように、根元から枝分かれしていく様を木に例えてこう呼ばれているわけです。また、一番上にくるノードは「根ノード」、一番下の、それ以上分岐がないノードを「葉ノード」と表したりします。
        </p>
        <img src="../articles/article2_imgs/img1.png" alt="木構造のつくりを説明する画像。一番上に「根ノード」として、オセロの初期盤面が書いてあり、そこから下に枝分かれする形で黒が取れる4つの手を取った場合の盤面が繋がっている。また、その4つの盤面から下方向にそれぞれ3つの丸が、「葉ノード」として枝分かれして繋がっている。この図は深さが2なので、丸の部分が葉ノードとなっている。">
        <p>
            この考え方はオセロに限らず、探索アルゴリズム系では非常によく用いられます。<br>
            木構造で管理する事によって、
        </p>
        <ul>
            <li>どの手をどれだけ試したか</li>
            <li>その手の勝率がどれくらいか</li>
        </ul>
        <p>
            といった情報をノードごとに保持、更新することができます。<br>
            これにより、モンテカルロ木探索では「よく勝てる手の枝を深く掘る」といった効率的な探索が可能になるのです。
        </p>
        <h4>備考</h4>
        <p>
            この「木構造」は次回紹介するminimax法などでも活用されています。次回は、モンテカルロ木探索とminimax法での木構造の扱い方の違いにも触れていく予定です。
        </p>
        <h3 id="3">3.モンテカルロ木探索の詳細</h3>
        <p>
            さて、先ほど
        </p>
        <ul style="color: gray;">
            <li>最初は全ての手を平等に試す</li>
            <li>試行を重ねていくうちに、勝率が高そうな手が見えてきたら、そちらを多めに試す</li>
            <li>ただし、初期の勝率はまだ不確かなので、他の手も試す（探索の幅を残す）</li>
        </ul>
        <p>
            と述べましたが、この後半の2点は決められた回数の中で「より一つの手に集中することで勝率を正確に求めたい」一方、「なるべく他の手も試して意外と強い手を見逃さないようにしたい」という矛盾を抱えているのです。<br>
            この相反する二つをどのように両立させたら良いでしょうか？<br>
            順を追って説明していきます。
        </p>
        <h4>まずは全ての手を試す</h4>
        <p>
            この部分はなんとなく想像できるかもしれません。そのままです。<br>
            まだ試していないノードが存在したら、それを一通り試します。こうすることで、そのノードから着手できる全ての手を少なくとも1回ずつ試したという状況を作ることができます。<br>
            具体的には、根ノードから取れる試したことのない手(ノード)を一つ選んだあと、そこから対局が終わるまでランダムに局面を進めます。(<b>シミュレーション</b>)この勝敗をシュミレーション中に通った各ノードに保存する(<b>バックプロパゲーション</b>)ことで、その手と勝敗の関係が統計的に蓄積されていくことになります。<br>
            また、この未探索のノードをランダムにシミュレーションすることを「<b>展開</b>」と呼びます。
        </p>
        <h4>優先順位をつける</h4>
        <p>
            すべての手(子ノード)が最低1回ずつ試されているノードの場合は、優先順位をつけて最も優先順位が高いものを試していきます。(<b>選択</b>)<br>
            この優先順位は、
        </p>
        <ul>
            <li>勝率が高い手</li>
            <li>試行回数が足りない手</li>
        </ul>
        <p>
            をもとに一定の決まりに沿って決定します。ここの難しい点は、その何回かのシミュレーションの結果による各ノードの既知の勝率利用(知識活用)と、シミュレーションの回数の不足による探索のバランスを取ることであり、また、この決定方法は無数に存在するため、「どの数式を使うのか」という問題も出てきます。<br>
            ここでは、比較的シンプルな<b>UCT(Upper Confidence Tree)</b>の数式を紹介します。<br>
            数式は、
        </p>
        <math class="formula">
            <mfrac>
                <mrow>
                    <mi>w</mi>
                </mrow>
                <msub>
                    <mi>n</mi>
                </msub>
            </mfrac>
            <mo>+</mo>
            <mi>c</mi>
            <msqrt>
                <mfrac>
                    <mrow>
                        <mi>ln</mi>
                        <mi>N</mi>
                    </mrow>
                    <msub>
                        <mi>n</mi>
                    </msub>
                </mfrac>
            </msqrt>
        </math>
        <p>
            と表され、文字の意味は
        </p>
        <ul>
            <li>w:そのノードを経由して勝った回数</li>
            <li>n:そのノードの試行回数</li>
            <li>N:そのノードの親ノードの試行回数（親が選ばれた回数）</li>
            <li>c:定数。知識活用と、探索のバランスを決めるパラメータで、理論上は<math><msqrt><mi>2</mi></msqrt></math>だが、運用時は探索がうまくいくように調整する。</li>
        </ul>
        <p>
            です。<br>
            左の項はそのノードの勝率、右の項はそのノードの「選ばれていなさ」で、試行回数が少ないほど値が大きくなります。また、そこにcをかけることで探索の重要度を決定しています。<br>
            このUCTは、
        </p>
        <ul>
            <li>よく試されていて勝率が高い手 → 点数が高くなる</li>
            <li>試行回数が少ない手 → まだチャンスがあると判断される(点数が高くなる)</li>
            <li>たくさん試されていて勝率も悪い手 → 点数が下がる</li>
        </ul>
        <p>
            といった特徴があり、「すべてのノードに関してこの計算を行い、最も数字が大きいノードでシミュレーションを進める。」というのを繰り返すことで、最終的には「勝てそうな手」へと試行が収束していくのです。<br>
            
        </p>
        <h4>
            最終的な決定
        </h4>
        <p>
            このようにして1つの根ノードで、決められた量の試行を行い、「最も勝てそうな手」を選びます。ここで重要なのは、選ぶノードは「最も勝率が高い手」ではなく、「最も試行回数が多い手」のノードであるということです。<br>
            これは、例えば
        </p>
        <ul>
            <li>試行回数が10回で、勝利数が5回(勝率50%)</li>
            <li>試行回数が1000回で、勝利数が499回(勝率49.9%)</li>
        </ul>
        <p>
            の2つの手があった場合、一見すると前者のほうが勝率は高いように見えますが、試行数が少ないため偶然の可能性もあります。<br>
            一方、後者は非常に多く試されており、信頼性の高い勝率と判断できます。モンテカルロ木探索では、試行が集中した=信頼されている手と考え、最も試行回数の多いノードを最終手として選ぶのです。
        </p>
        <img src="../articles/article2_imgs/img2.png" alt="モンテカルロ木探索の概要を表すフローチャート">
        <img src="../articles/article2_imgs/img3.png" alt="モンテカルロ木探索の概要を木構造の図を用いて説明する画像">
        <p>※上図のノードGの子ノードは、ノードH,I,Jの他にもあり、合計で18個以上あると思ってください。</p>
        <h3 id="4">4.おわりに</h3>
        <p>
            この記事では、モンテカルロ木探索について詳しく解説してきました。次回は、前回紹介した「minimax法」に関して、モンテカルロ木探索との違いも絡めつつ解説します。
        </p>
        <div class="ads">
            <!-- admax -->
            <div class="admax-switch" data-admax-id="305a1205361b0f40d49aae13519ccbea" style="display:inline-block;"></div>
            <script type="text/javascript">
            (admaxads = window.admaxads || []).push({admax_id: "305a1205361b0f40d49aae13519ccbea",type: "switch"});</script>
            <script type="text/javascript" charset="utf-8" src="https://adm.shinobi.jp/st/t.js" async></script>
            <!-- admax -->
        </div>
        <p><br><br>次の記事↓</p>
        <a href="../articles/procon1.html" target="_blank" class="same_domain">
            <div>
                <img src="" alt="リンク先のページのサムネイル画像">
                <section><h5></h5><p></p></section>
            </div>
        </a>
        <p>前回の記事↓</p>
        <a href="../articles/article1.html" target="_blank" class="same_domain">
            <div>
                <img src="" alt="リンク先のページのサムネイル画像">
                <section><h5></h5><p></p></section>
            </div>
        </a>
    </div>
    <div id="fotter">
                <a id="x" href="https://x.com/e_Coachi_AI" target="_blank">
                    <img src="../imgs/logo-black.png" alt="SNSであるXのロゴ画像" id="x_logo"><span>@e_Coachi_AI</span>
                </a>
                <p>&copy; 2025 ЯAMUNE</p>
            </div>
    <script src="../article.js"></script>
</body>
</html>